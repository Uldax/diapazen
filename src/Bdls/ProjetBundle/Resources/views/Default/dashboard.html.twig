{% extends 'BdlsProjetBundle:Default:layout.html.twig' %}
	{% block body %}
        <div id="content">
                <a href="{{ path('bdls_projet_index') }}" id="new_poll" class="orange_button">Créer un nouvel évènement</a>
            <div id="float_button_dashboard">
                <a id="dashboard_form" class="orange_button" href="{{ path('bdls_projet_profil') }}">Modifier mes données personnelles</a>
            </div>
            <h2 class="small_title small_title_dashboard">Vos sondages</h2>

            {# NON fonctionnel, il faut valider le script #}
            {% if (data_updated is defined) and (data_updated is not null) %}
                    {% if data_updated %}
                        <div class="success_message message_dashboard">Le sondage a été clôturé avec succés.</div>
                    {% else %}
                        <div class="error_message message_dashboard">Erreur lors de la clôture du sondage.</div>
                    {% endif %}
                    {# à vérifier #}
                    <script>
                        $('.message_dashboard').delay(4000).slideUp(300);
                    </script>
            {% endif %}
        
            <div class="text" id="poll_list">
                <table>
                    <tr cols="3" class="head_dash">
                        <td>Type</td><td>Ouvert le</td><td>Cloture le</td><td>Titre</td><td>Description</td><td></td>
                    </tr>
                    {% for row in pollList %}
                        {% if row.open %}

                            <tr class="opened_poll">
                                <td>{{ row.type }}</td>
                                <td>{{ row.date_open }}</td>
                                <td>{{ row.date_close}}</td>
                                <td>{{ row.title }}</td>
                                <td>{{ row.description }}
                                    {{ row.short_type }}
                                    {{ row.URL}}</td>
                                <td> 
                                    {# à modifier l'adresse du lien -> bdls_projet_view#}
                                   <a class="orange_small_button" href="{{ path('bdls_projet_view',{'type': row.short_type,'url': row.URL } )}}">Voir</a> 

                                    <form action="{{ path('bdls_projet_dashboard') }}" onsubmit="return confirm('Clôturer le sondage ?');" method="post">
                                        <input type="hidden" name="close_id" value="{{ row.id }}"> 
                                        <input type="hidden" name="close_type" value="{{ row.short_type }}"> 
                                        <input type="submit" class="grey_small_button" value="Clôturer">
                                    </form>
                                </td>

                        {% else %}

                            <tr class="closed_poll">
                                <td>{{ row.type }}</td>
                                <td>{{ row.date_open }}</td>
                                <td>{{ row.date_close}}</td>
                                <td>{{ row.title }}</td>
                                <td>{{ row.description }}
                                    {{ row.short_type }}
                                    {{ row.URL}}</td>
                                <td> 
                                    <a class="orange_small_button" href="{{ path('bdls_projet_view',{'type': row.short_type,'url': row.URL } )}}">Voir</a> 
                                </td>

                        {% endif %}

                            </tr>

                    {% endfor %}

                </table>
            </div>
        </div>
	{% endblock %}
        