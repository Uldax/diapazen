{% extends 'BdlsProjetBundle:Default:layout.html.twig' %}   
{% block body %}
	<div id="content">
		<div id ="poll">
			<div id="back_button_dashboard">
				<a class="orange_button" href="{{ path('bdls_projet_index') }}" >Retour</a>
			</div>
			<div id="poll_title_box" >
				{#$eventTitle#}
				<h1 class="title" > nom du sondage </h1>
				{#$creationDate, $userFName, $userLName, $eventDate#}
				<p class="text">Créé le 'date_creation' | Par 'user_name' 'user_last_name' 'date_event'</p>
				{#<!--<p class="text">Créé le {{ date_de_creation }} | Par {{ userName, userLName, eventDate }}</p>-->#}
			</div>
			{#$eventDescription#}
			<p class="text" > description du sondage </p>
			{#<?php if (!$openedPoll) { ?>   ?????????????????????????????????????????????????????????????????????????????????????????????????????????????? #}
			{#$choiceList[0]["choiceName"]#}
			<h1 class="big_title" id="result">Le choix ayant recueilli le plus de voix est: ???</h1>
			{#<?php } ?>#}
			{#$this->getHomeUrl(); echo '/poll/view/'.$urlPoll  =>  http://127.0.0.1/poll/view/$urlPoll#}
			<form onsubmit="return formCheck(this)" method="post" action="view">
				<div id="poll_choices">
					<table>
						<?php
							$i = 0;
							foreach ($choiceList as $key => $row) {
						?>

						<tr>

							<?php 
								if ($openedPoll == true) {       
							?>

							<td><input type="checkbox" name="choiceId[]" value="<?php echo $key; ?>"></td>

							<?php
								}
								else {
							?>

							<td class="text"><?php echo $key+1; ?></td>

							<?php
								}
							?>

							<td class="text"><?php echo $row['choiceName'] ?> </td> 
							<td class="progression_bar">
								<div class="container">
									<div class="meter" style="width: 50%"></div>
									<p class="small_text"><?php echo $row['percent'].'%'; ?></p>
								</div>
							</td>   
							<td class="text">

							<?php
								$nbPeople = count($row['checkList']);

								if ($nbPeople == 1) {
									echo $row['checkList'][0].' a voté';
								}
								elseif ($nbPeople == 2) {
									 echo $row['checkList'][0].' et '.$row['checkList'][1].' ont voté';
								}
								elseif ($nbPeople > 2) {
									 echo $row['checkList'][0].' et <span id="link_'.$i.'" class="link">'.($nbPeople-1).' autres personnes</span> ont voté'; 
								}
								else {
									echo 'Aucune personne n\'a encore voté.';

								}
								/*On ajoute la fenêtre pop up pour les autres personnes ayant voté*/
								if ($nbPeople > 2) {

							?>

								<div id="<?php echo 'vote_list_'.$i; ?>" class="vote_list">
									<ul>

										<?php
											/* On remplit la liste des personnes ayant voté*/
											for ($j=1; $j < $nbPeople; $j++) { 

										?>

										<li> <?php echo $row['checkList'][$j]; ?> </li>

										<?php    
											}
										?>

									</ul>
								</div>

								<script type="text/javascript">
									document.getElementById("<?php echo 'link_'.$i; ?>").addEventListener('mouseover', function(e){

										document.getElementById("<?php echo 'vote_list_'.$i; ?>").style.display = "block";
									}, false);
									document.getElementById("<?php echo 'link_'.$i; ?>").addEventListener('mouseout', function(e){

										document.getElementById("<?php echo 'vote_list_'.$i; ?>").style.display = "none";
									}, false);
								</script>

							<?php
									$i = $i + 1;
								}
							?>
							</td>
						</tr>

						<?php
							}
						?>
					</table>
				</div>
				<?php if ($openedPoll) {?>
				<input type="text" class="small_text_edit" placeholder="Prénom Nom" name="value" value="<?php if ($this->isUserConnected()){ echo $this->getUserInfo('firstname').' '.$this->getUserInfo('lastname'); } ?>">
				<input type="submit" class="orange_small_button" value="Voter" >
				<?php } ?>
				<?php 
					if(isset($data_updated)) {
						if($data_updated) { ?>
							<div style="float: right;" class="success_message message_personal_data">Votre vote a bien été pris en compte.</div>
						<?php
						} else { ?>
							<div style="float: right;" class="error_message message_personal_data">Erreur, vérifiez les données saisies.</div>
						<?php
						}
						?>
						<script>
							$('.success_message').delay(4000).slideUp(300);
						</script>
				<?php
					 }
				?>
			</form>
		</div>
	</div>
{% endblock %}