{% extends 'PoolBundle::layout.html.twig' %}
	{% block body %}
        <div id="content" class="hidden-xs">
                <a href="{{ path('poll_index') }}" id="new_poll" class="btn btn-default orange_small_button">Créer un nouvel évènement</a>
            <h2 class="small_title small_title_dashboard">Vos sondages</h2>

            {# NON fonctionnel, il faut valider le script #}
            {% if (data_updated is defined) and (data_updated is not null) %}
                    {% if data_updated %}
                        <div class="success_message message_dashboard">Le sondage a été clôturé avec succés.</div>
                    {% else %}
                        <div class="error_message message_dashboard">Erreur lors de la clôture du sondage.</div>
                    {% endif %}
                    {# à vérifier #}
                    <script>
                        $('.message_dashboard').delay(4000).slideUp(300);
                    </script>
            {% endif %}
            <!--<div class="text" id="poll_list">-->
            <div class="table-responsive" id="poll_list">
                <table class="table">
                    <thead>
                        <tr cols="3" class="head_dash">
                            <th>Type</th><th>Ouvert le</th><th>Cloture le</th><th>Titre</th><th>Description</th><th></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for row in pollList %}
                        {% if row.open %}

                            <tr class="opened_poll">
                                <td>{{ row.type }}</td>
                                <td>{{ row.date_open }}</td>
                                <td>{{ row.date_close}}</td>
                                <td>{{ row.title }}</td>
                                <td>{{ row.description }}</td>
                                <td> 
                                    {# à modifier l'adresse du lien -> poll_view#}
                                   <a class="btn btn-default orange_small_button" href="{{ path('poll_view',{'type': row.short_type,'url': row.URL } )}}">Voir</a>

                                    <form action="{{ path('poll_dashboard') }}" onsubmit="return confirm('Clôturer le sondage ?');" method="post">
                                        <input type="hidden" name="close_id" value="{{ row.id }}"> 
                                        <input type="hidden" name="close_type" value="{{ row.short_type }}"> 
                                        <input type="submit" class="btn btn-default grey_small_button" value="Clôturer">
                                    </form>
                                </td>

                        {% else %}

                            <tr class="closed_poll">
                                <td>{{ row.type }}</td>
                                <td>{{ row.date_open }}</td>
                                <td>{{ row.date_close}}</td>
                                <td>{{ row.title }}</td>
                                <td>{{ row.description }}</td>
                                <td> 
                                    <a class="btn btn-default orange_small_button" href="{{ path('poll_view',{'type': row.short_type,'url': row.URL } )}}">Voir</a>
                                </td>

                        {% endif %}

                            </tr>
                            </tbody>
                    {% endfor %}

                </table>
            </div>
        </div>

        <!-- Version Mobile -->
        <div id="content_mobile" class="visible-xs">
            <a href="{{ path('poll_index') }}" id="new_poll" class="btn btn-default orange_small_button">Créer un nouvel évènement</a>
            <h2 class="small_title small_title_dashboard">Vos sondages</h2>

            {# NON fonctionnel, il faut valider le script #}
            {% if (data_updated is defined) and (data_updated is not null) %}
                    {% if data_updated %}
                        <div class="success_message message_dashboard">Le sondage a été clôturé avec succés.</div>
                    {% else %}
                        <div class="error_message message_dashboard">Erreur lors de la clôture du sondage.</div>
                    {% endif %}
                    {# à vérifier #}
                    <script>
                        $('.message_dashboard').delay(4000).slideUp(300);
                    </script>
            {% endif %}
            <!--<div class="text" id="poll_list">-->
            <div class="table-responsive" id="poll_list">
                <table class="table">
                    <thead>
                        <tr cols="3" class="head_dash">
                            <th>Type</th><th>Ouvert le</th><th>Cloture le</th><th>Titre</th><th>Description</th><th></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for row in pollList %}
                        {% if row.open %}

                            <tr class="opened_poll">
                                <td>{{ row.type }}</td>
                                <td>{{ row.date_open }}</td>
                                <td>{{ row.date_close}}</td>
                                <td>{{ row.title }}</td>
                                <td>{{ row.description }}</td>
                                <td> 
                                    {# à modifier l'adresse du lien -> poll_view#}
                                   <a class="btn btn-default orange_small_button" href="{{ path('poll_view',{'type': row.short_type,'url': row.URL } )}}">Voir</a>

                                    <form action="{{ path('poll_dashboard') }}" onsubmit="return confirm('Clôturer le sondage ?');" method="post">
                                        <input type="hidden" name="close_id" value="{{ row.id }}"> 
                                        <input type="hidden" name="close_type" value="{{ row.short_type }}"> 
                                        <input type="submit" class="btn btn-default grey_small_button" value="Clôturer">
                                    </form>
                                </td>

                        {% else %}

                            <tr class="closed_poll">
                                <td>{{ row.type }}</td>
                                <td>{{ row.date_open }}</td>
                                <td>{{ row.date_close}}</td>
                                <td>{{ row.title }}</td>
                                <td>{{ row.description }}</td>
                                <td> 
                                    <a class="btn btn-default orange_small_button" href="{{ path('poll_view',{'type': row.short_type,'url': row.URL } )}}">Voir</a>
                                </td>

                        {% endif %}

                            </tr>
                            </tbody>
                    {% endfor %}

                </table>
            </div>
        </div>
	{% endblock %}
        